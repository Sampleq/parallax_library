<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parallax rellax libraries</title>
    <link rel="stylesheet" href="./styles/index.scss">
    <link rel="icon" type="image/png" href="./images/favicon-128.png" sizes="128x128">
    <link rel="apple-touch-icon" sizes="180x180" href="./images/apple-touch-icon-180.png">
</head>

<body>
    <main class="main">
        <div class="main__wrapper wrapper">
            <div class="main__circle main__circle_1 rellax" data-rellax-speed="-1"></div>
            <h1 class="main__title">Scroll me!</h1>

            <p class="rellax main__desc" data-rellax-speed="-1.5">
                <span class="horellax" data-rellax-horizontal-speed="-17" data-rellax-mobile-horizontal-speed="-20"
                    data-rellax-vertical-scroll-axis="x">Cool</span>
                <span class="horellax" data-rellax-horizontal-speed="17" data-rellax-mobile-horizontal-speed="15"
                    data-rellax-vertical-scroll-axis="x">JavaScript</span>
                <span class="horellax" data-rellax-horizontal-speed="-27" data-rellax-mobile-horizontal-speed="-29"
                    data-rellax-vertical-scroll-axis="x">libraries</span>
            </p>

            <div class="main__img-cont">
                <img src="./images/city.jpg" alt="img" class="main__img">
            </div>

            <p class="rellax main__desc main__desc_2" data-rellax-speed="0.5">Parallax demo</p>
            <p class="rellax main__desc main__desc_3" data-rellax-speed="-3.5">Using <br>my-rellax-analog.js</p>


            <button class="btn main__btn">Switch to <b>rellax.js</b></button>

            <button class="btn main__btn main__btn_fix_glitch">Fix mob. addres-tab glitch of rellax.js</button>

        </div>

        <div class="main__img_misc-cont">
            <img src="./images/misc.png" alt="main__img_misc" class="scene main__img_misc" data-depth="-0.1">
        </div>

        <div class="rellax main__scene main__scene_2" id="scene2" data-rellax-speed="-3">
            <div class=" main__circle main__circle_2" data-depth="-1.8"></div>
        </div>
        <div class="rellax main__scene main__scene_3" id="scene3" data-rellax-speed="5">
            <div class="main__circle main__circle_3" data-depth="1.4"></div>
        </div>
        <div class="rellax main__scene main__scene_4" id="scene4" data-rellax-speed="10">
            <div class="main__circle main__circle_4" data-depth="0.4"></div>
        </div>
        <div class="rellax main__scene main__scene_5" id="scene5" data-rellax-speed="1">
            <div class="main__circle main__circle_5" data-depth="-1.4"></div>
        </div>
        <div class="rellax main__scene main__scene_6" id="scene6" data-rellax-speed="-1">
            <div class="main__circle main__circle_6" data-depth="3.4"></div>
        </div>
        <div class="rellax main__scene main__scene_7" id="scene7" data-rellax-speed="2">
            <div class="main__circle main__circle_7" data-depth="0.8"></div>
        </div>
        <div class="rellax main__scene main__scene_8" id="scene8" data-rellax-speed="4">
            <div class="main__circle main__circle_8" data-depth="2.8"></div>
        </div>
        <div class="rellax main__scene main__scene_9" id="scene9" data-rellax-speed="-1">
            <div class="main__circle main__circle_9" data-depth="1.0"></div>
        </div>
        <div class="rellax main__scene main__scene_10" id="scene10" data-rellax-speed="-1.5">
            <div class="main__circle main__circle_10" data-depth="-2.4"></div>
        </div>
        <div class="rellax main__scene main__scene_11" id="scene11" data-rellax-speed="2">
            <div class="main__circle main__circle_11" data-depth="3.5"></div>
        </div>
        <div class=" main__scene main__scene_12" id="scene12" data-rellax-speed="-8">
            <div class="main__circle main__circle_12" data-depth="0.2"></div>
        </div>
        <div class="rellax main__scene main__scene_13" id="scene13" data-rellax-speed="-5">
            <div class="main__circle main__circle_13" data-depth="-0.3"></div>
        </div>
        <div class="rellax main__scene main__scene_14" id="scene14" data-rellax-speed="-6">
            <div class="main__circle main__circle_14" data-depth="0.35"></div>
        </div>
        <!-- <div class="rellax main__scene main__scene_15" id="scene15" data-rellax-speed="-2">
            <div class="main__circle main__circle_15" data-depth="-0.25"></div>
        </div> -->
        <div class="rellax main__scene main__scene_16" id="scene16" data-rellax-speed="-8"
            data-rellax-mobile-speed="-4">
            <div class="main__circle main__circle_16" data-depth="0.1"></div>
        </div>

    </main>


    <!-- <script src="https://cdn.jsdelivr.net/gh/dixonandmoe/rellax@master/rellax.min.js"></script> -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/parallax/3.1.0/parallax.min.js"></script> -->

    <!-- <script src="./js/js-libs/rellax.js"></script> -->
    <!-- <script src="./js/js-libs/parallax.js"></script> не работает(-->
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            // document.body.addEventListener('touchend', () => {
            function detect_iOS() {
                return /* создаём массив с перечислением названий устройств на iOS */[
                    'iPad Simulator',
                    'iPhone Simulator',
                    'iPod Simulator',
                    'iPad',
                    'iPhone',
                    'iPod'
                ].includes(navigator.platform)
                    // iPad on iOS 13 detection
                    || (navigator.userAgent.includes("Mac") && "ontouchend" in document)
            }


            if (detect_iOS()) {
                document.body.addEventListener('touchend', () => {
                    DeviceOrientationEvent.requestPermission();
                    console.log('DeviceOrientationEvent.requestPermission();');

                    let newScriptTag = document.createElement('script');
                    newScriptTag.src = './js/js-libs/parallax.min.js';
                    document.body.appendChild(newScriptTag);

                    setTimeout(() => {
                        document.body.addEventListener('scroll', () => {
                            const scenes = document.querySelectorAll('.main__scene');
                            for (let scene of scenes) {
                                new Parallax(scene);
                            }

                            new Parallax(document.querySelector('.main__img_misc-cont'));
                            console.log(
                                `new Parallax(document.querySelector('.main__img_misc-cont'))`
                            );
                        }, { once: true });
                    }, 123);

                }, { once: true });

            } else {
                let newScriptTag = document.createElement('script');
                newScriptTag.src = './js/js-libs/parallax.min.js';
                document.body.appendChild(newScriptTag);

                setTimeout(() => {
                    const scenes = document.querySelectorAll('.main__scene');
                    for (let scene of scenes) {
                        new Parallax(scene);
                    }

                    new Parallax(document.querySelector('.main__img_misc-cont'));
                    console.log(
                        `new Parallax(document.querySelector('.main__img_misc-cont'))`
                    );
                }, 123);
            }
        }, { once: true });

    </script>
    <!-- <script src="./js/js-libs/parallax.min.js"></script> -->


    <!-- <script>
        var rellax = new Rellax('.rellax');
    </script> -->

    <!-- убираем скрытие address-bar в мобильных браузерах - через body   position: fixed; и библиотекой Rellax смотрим за скроллом body.
    Без этого на iPhone (iOS 15.7.7 15.3.1) глюк - при появлении/скрытии address-bar изменяется положение элементов (translateY), смещаемых с помощью  Rellax. Такой же глюк присутствует на https://coolbackgrounds.io/ . 
    А на демо сайте библиотеки https://dixonandmoe.com/rellax/  - глюка при появлении/скрытии address-bar нет!
    -->
    <!-- <script>
        // Set wrapper to custom-element (body) instead of the html
        var rellax = new Rellax('.rellax', {
            wrapper: 'body'
        });
    </script> -->


    <!-- <div id="scene">
        <div data-depth="0.2">My first Layer!</div>
        <div data-depth="0.6">My second Layer!</div>
    </div> -->
    <script>
        // var scene = document.getElementById('scene');
        // var parallaxInstance = new Parallax(scene);

        // обращаемся циклом ко всем оберткам (.main__scene) шариков и передаём их в функции Parallax. Библиотека parallax.js двигает детей (с html аттрибутом data-depth="-1.8") контейнера который передали аргументом в функцию Parallax.
        // применяем именно к оберткам (.main__scene) т.к. библиотека parallax.js  задаёт инлайновое свойство position:relative детям, а в нашем конкретном случае нужно чтобы у .main__scene было position:absolute.
        //  (Чтобы запускать один экземпляр функции (и двигать множество детей , а не запускать много функций и двигать по одному ребёнку) можно при желании переписать разметку  html и  использовать в css !important для position, top , right, left:unset, чтобы переопределять инлайновый стили которые задаёт библиотека parallax.js)
        // const scenes = document.querySelectorAll('.main__scene');
        // for (let scene of scenes) {
        //     new Parallax(scene);
        // }

        // new Parallax(document.querySelector('.main__img_misc-cont'));

    </script>

    <!-- подключаем свой аналог библиотеки Rellax -->
    <script src="./scripts/my-rellax-analog.js"></script>


    <script src="./scripts/switch-js-libs-btn.js"></script>


    <div class="button_up" id="btn_up"></div>
    <script src="./scripts/button_up.js"></script>
</body>

</html>